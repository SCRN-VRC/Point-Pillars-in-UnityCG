#ifndef _BITONIC_CRT_
#define _BITONIC_CRT_

/*
    Unrolled bitonic merge sort loop for a 512x512 texture
*/

static const uint flipArray[189] =
{
    2, 2, 4, 4, 4, 8, 8, 8, 8, 
    16, 16, 16, 16, 16, 32, 32, 32, 32, 
    32, 32, 64, 64, 64, 64, 64, 64, 64, 
    128, 128, 128, 128, 128, 128, 128, 128, 256, 
    256, 256, 256, 256, 256, 256, 256, 256, 512, 
    512, 512, 512, 512, 512, 512, 512, 512, 512, 
    1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 
    1024, 1024, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 
    2048, 2048, 2048, 2048, 2048, 4096, 4096, 4096, 4096, 
    4096, 4096, 4096, 4096, 4096, 4096, 4096, 4096, 4096, 
    8192, 8192, 8192, 8192, 8192, 8192, 8192, 8192, 8192, 
    8192, 8192, 8192, 8192, 8192, 16384, 16384, 16384, 16384, 
    16384, 16384, 16384, 16384, 16384, 16384, 16384, 16384, 16384, 
    16384, 16384, 32768, 32768, 32768, 32768, 32768, 32768, 32768, 
    32768, 32768, 32768, 32768, 32768, 32768, 32768, 32768, 32768, 
    65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 
    65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 131072, 
    131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 
    131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 262144, 
    262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 
    262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144
};

static const uint disperseArray[189] =
{
    1, 0, 2, 1, 0, 4, 2, 1, 0, 
    8, 4, 2, 1, 0, 16, 8, 4, 2, 
    1, 0, 32, 16, 8, 4, 2, 1, 0, 
    64, 32, 16, 8, 4, 2, 1, 0, 128, 
    64, 32, 16, 8, 4, 2, 1, 0, 256, 
    128, 64, 32, 16, 8, 4, 2, 1, 0, 
    512, 256, 128, 64, 32, 16, 8, 4, 2, 
    1, 0, 1024, 512, 256, 128, 64, 32, 16, 
    8, 4, 2, 1, 0, 2048, 1024, 512, 256, 
    128, 64, 32, 16, 8, 4, 2, 1, 0, 
    4096, 2048, 1024, 512, 256, 128, 64, 32, 16, 
    8, 4, 2, 1, 0, 8192, 4096, 2048, 1024, 
    512, 256, 128, 64, 32, 16, 8, 4, 2, 
    1, 0, 16384, 8192, 4096, 2048, 1024, 512, 256, 
    128, 64, 32, 16, 8, 4, 2, 1, 0, 
    32768, 16384, 8192, 4096, 2048, 1024, 512, 256, 128, 
    64, 32, 16, 8, 4, 2, 1, 0, 65536, 
    32768, 16384, 8192, 4096, 2048, 1024, 512, 256, 128, 
    64, 32, 16, 8, 4, 2, 1, 0, 131072, 
    65536, 32768, 16384, 8192, 4096, 2048, 1024, 512, 256, 
    128, 64, 32, 16, 8, 4, 2, 1, 0
};

#define LOOP_END                      21
#define txLoopCounter                 uint2(0, 0)

void StoreValue(in uint2 txPos, in float value, inout float col,
    in uint2 fragPos)
{
    col = all(fragPos == txPos) ? value : col;
}

#endif